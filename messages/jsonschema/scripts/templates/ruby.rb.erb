require 'json'

# The code was auto-generated by {this script}[https://github.com/cucumber/common/blob/main/messages/jsonschema/scripts/codegen.rb]
#

module Cucumber
  module Messages
  <%- @schemas.sort.each do |key, schema| %>

    ##
    # Represents the <%= class_name(key) %> message in Cucumber's {message protocol}[https://github.com/cucumber/common/tree/main/messages#readme].
    #
    <%= format_description(schema['description']) %>
    #

    class <%= class_name(key) %>
    <%- schema['properties'].each do |property_name, property| -%>

      <%- if property['description'] -%>
      ##
      <%= format_description(property['description'], indent_string: '      ') %>

      <%- end -%>
      attr_reader :<%= underscore(property_name) %>
    <%- end -%>

      def self.from_json(json)
        from_camel_symbol_hash(JSON.parse(json, {symbolize_names: true}))
      end

      def self.from_camel_symbol_hash(hash)
        return nil if hash.nil?
        self.new(
        <%- schema['properties'].each do |property_name, property| -%>
          <%- ref = property['$ref'] -%>
          <%- if ref -%>
          <%= underscore(property_name) %>: <%= class_name(ref) %>.from_camel_symbol_hash(hash[:<%= property_name -%>]),
          <%- else -%>
          <%= underscore(property_name) %>: hash[:<%= property_name -%>],
          <%- end -%>
        <%- end -%>
        )
      end

      def initialize(
      <%- schema['properties'].each do |property_name, property| -%>
        <%= underscore(property_name) -%>: <%=
          (schema['required'] || []).index(property_name) ?
            default_value(class_name(key), property_name, property) :
            'nil'
          -%><%= property_name == schema['properties'].keys.last ? '' : ',' %>
      <%- end -%>
      )
      <%- schema['properties'].each do |property_name, property| -%>
        @<%= underscore(property_name) %> = <%= underscore(property_name) %>
      <%- end -%>
      end

      def to_camel_symbol_hash
        {
        <%- schema['properties'].each do |property_name, property| -%>
          <%- ref = property['$ref'] -%>
          <%- if ref -%>
          <%= property_name %>: <%= underscore(property_name) -%> ? <%= underscore(property_name) -%>.to_camel_symbol_hash : nil,
          <%- else -%>
          <%= property_name %>: <%= underscore(property_name) -%>,
          <%- end -%>
        <%- end -%>
        }.delete_if {|k,v| v.nil?}
      end

      def to_json
        to_camel_symbol_hash.to_json
      end

    end
  <%- end %>
  end
end
